---
title: "Crosstabbing DFP First Debate Survey"
output: html_notebook
---

Link to xtabs:

# Load data and packages and calculate race/sex resentment scales
```{r}
library(tidyverse)

infile <- read_delim('/Users/joshyazman/Desktop/open-survey-data/data-for-progress/first-debate-2020/FIRSTDEBATE_DATA.csv', delim = '|')
colnames(infile) <- tolower(colnames(infile))

infile_a <- infile%>%
  mutate(remarks = ifelse(remarks == 6, 3, remarks),
         offend = ifelse(offend == 6, 3, offend),
         appreciate = ifelse(appreciate == 6, 3, appreciate),
         control = ifelse(control == 6, 3, control),
         favors = ifelse(favors == 6, 3, favors),
         generations = ifelse(generations == 6, 3, generations),
         fear = ifelse(fear == 6, 3, fear),
         empathy = ifelse(empathy == 6, 3, empathy),
         system = ifelse(system == 6, 3, system),
         institution = ifelse(institution == 6, 3, institution),
         index = row_number())

# make separate df that's just complete responses to battery and index
sexism <- na.omit(infile_a[,c('remarks','offend','appreciate','control','index')])
racism <- na.omit(infile_a[,c('favors','generations','empathy','system','institution','index')]) # ,'fear'

# remove rows that have the same response to each item (indicates satisficing)
sexism_satisfice_check <- sexism%>%
  mutate(satisfice_flag = ifelse(remarks == offend 
                                 & remarks == appreciate 
                                 & remarks == control, 0, 0))%>% # Removed this flag because all questions had the same polarity
  filter(satisfice_flag == 0)

racism_satisfice_check <- racism%>%
mutate(satisfice_flag = ifelse(favors == generations 
                                 & favors == empathy 
                                 & favors == system 
                                 & favors == institution, 1, 0))%>%
  filter(satisfice_flag == 0)

# check that all items scale together (drop items where alpha increases if it's dropped)
psych::alpha(sexism_satisfice_check[,c(1:4)], check.keys = TRUE)
psych::alpha(racism_satisfice_check[,c(1:5)], check.keys = TRUE)

# get principal components
pca.sexism <- princomp(sexism_satisfice_check[,1:4])
sumsexism <- summary(pca.sexism)
loadsexism <- loadings(pca.sexism)

pca.racism <- princomp(racism_satisfice_check[,1:5])
sumracism <- summary(pca.racism)
loadracism <- loadings(pca.racism)

# return first dimension loadings
sexism_satisfice_check$sexism <- pca.sexism$scores[,1]
summary(sexism_satisfice_check$sexism)
racism_satisfice_check$racism <- pca.racism$scores[,1]
summary(racism_satisfice_check$racism)
# join back to main df
dfp <- infile_a %>% 
  left_join(sexism_satisfice_check[,c("index","sexism")], by = "index")%>%
  left_join(racism_satisfice_check[,c("index","racism")], by = "index")%>%
  mutate(sexism_quintile = ntile(sexism, 5),
         racism_quintile = ntile(racism, 5))

```

# Define Xtab function
This function allows users to input a row variable (akin to a pivot table) and specify the columns in the data.

In this case I want to calculate name id, candidate preference, candidate consideration, and magic wand for pre and post weighted (and overall for good measure). This will produce a really wide file that I index/match into a nicer display in Google Sheets
```{r}
calculate_pcts <- function(x){
  x/sum(x)
}

xtabber <- function(tbl = dfp, xtab_order = 1, row_var = 'gender'){
  dfp_n <- tbl%>%
    mutate_(rv = row_var)%>%
    filter(!is.na(rv))%>%
    group_by(grouper = rv)%>%
    summarise(n = n(),
              raw_n = n(), # Calculate again for the mutate_at bit down the road
              pre_weighted_n = sum(as.numeric(weight_predebate), na.rm = TRUE),              
              post_weighted_n = sum(as.numeric(as.numeric(weight_postdebate)), na.rm = TRUE),              
              full_weighted_n = sum(as.numeric(weight_fullsample), na.rm = TRUE),
              avg_racism = mean(racism, na.rm = TRUE),
              avg_sexism = mean(sexism, na.rm = TRUE),
              nameid_20_jb_pre_n = sum(ifelse(nameid_20_jb < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_bs_pre_n = sum(ifelse(nameid_20_bs < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_kh_pre_n = sum(ifelse(nameid_20_kh < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_bo_pre_n = sum(ifelse(nameid_20_bo < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_cb_pre_n = sum(ifelse(nameid_20_cb < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_ak_pre_n = sum(ifelse(nameid_20_ak < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_ew_pre_n = sum(ifelse(nameid_20_ew < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_jh_pre_n = sum(ifelse(nameid_20_jh < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_kg_pre_n = sum(ifelse(nameid_20_kg < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_jd_pre_n = sum(ifelse(nameid_20_jd < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_jc_pre_n = sum(ifelse(nameid_20_jc < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_bd_pre_n = sum(ifelse(nameid_20_bd < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_tg_pre_n = sum(ifelse(nameid_20_tg < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_pb_pre_n = sum(ifelse(nameid_20_pb < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_ji_pre_n = sum(ifelse(nameid_20_ji < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_tr_pre_n = sum(ifelse(nameid_20_tr < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_sm_pre_n = sum(ifelse(nameid_20_sm < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_es_pre_n = sum(ifelse(nameid_20_es < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_ay_pre_n = sum(ifelse(nameid_20_ay < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_mw_pre_n = sum(ifelse(nameid_20_mw < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_mg_pre_n = sum(ifelse(nameid_20_mg < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_sb_pre_n = sum(ifelse(nameid_20_sb < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_mb_pre_n = sum(ifelse(nameid_20_mb < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_wm_pre_n = sum(ifelse(nameid_20_wm < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_mn_pre_n = sum(ifelse(nameid_20_mn < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_js_pre_n = sum(ifelse(nameid_20_js < 3, weight_predebate, 0), na.rm = TRUE),
              nameid_20_jb_post_n = sum(ifelse(nameid_20_jb < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_bs_post_n = sum(ifelse(nameid_20_bs < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_kh_post_n = sum(ifelse(nameid_20_kh < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_bo_post_n = sum(ifelse(nameid_20_bo < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_cb_post_n = sum(ifelse(nameid_20_cb < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_ak_post_n = sum(ifelse(nameid_20_ak < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_ew_post_n = sum(ifelse(nameid_20_ew < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_jh_post_n = sum(ifelse(nameid_20_jh < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_kg_post_n = sum(ifelse(nameid_20_kg < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_jd_post_n = sum(ifelse(nameid_20_jd < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_jc_post_n = sum(ifelse(nameid_20_jc < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_bd_post_n = sum(ifelse(nameid_20_bd < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_tg_post_n = sum(ifelse(nameid_20_tg < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_pb_post_n = sum(ifelse(nameid_20_pb < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_ji_post_n = sum(ifelse(nameid_20_ji < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_tr_post_n = sum(ifelse(nameid_20_tr < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_sm_post_n = sum(ifelse(nameid_20_sm < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_es_post_n = sum(ifelse(nameid_20_es < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_ay_post_n = sum(ifelse(nameid_20_ay < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_mw_post_n = sum(ifelse(nameid_20_mw < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_mg_post_n = sum(ifelse(nameid_20_mg < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_sb_post_n = sum(ifelse(nameid_20_sb < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_mb_post_n = sum(ifelse(nameid_20_mb < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_wm_post_n = sum(ifelse(nameid_20_wm < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              nameid_20_js_post_n = sum(ifelse(nameid_20_js < 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_jb_pre_n = sum(ifelse(considering20_2 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_bs_pre_n = sum(ifelse(considering20_20 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_kh_pre_n = sum(ifelse(considering20_12 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_bo_pre_n = sum(ifelse(considering20_18 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_cb_pre_n = sum(ifelse(considering20_3 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_ak_pre_n = sum(ifelse(considering20_15 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_ew_pre_n = sum(ifelse(considering20_22 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_jh_pre_n = sum(ifelse(considering20_13 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_kg_pre_n = sum(ifelse(considering20_10 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_jd_pre_n = sum(ifelse(considering20_8 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_jc_pre_n = sum(ifelse(considering20_6 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_bd_pre_n = sum(ifelse(considering20_7 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_tg_pre_n = sum(ifelse(considering20_9 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_pb_pre_n = sum(ifelse(considering20_5 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_ji_pre_n = sum(ifelse(considering20_14 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_tr_pre_n = sum(ifelse(considering20_19 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_sm_pre_n = sum(ifelse(considering20_17 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_es_pre_n = sum(ifelse(considering20_21 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_ay_pre_n = sum(ifelse(considering20_24 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_mw_pre_n = sum(ifelse(considering20_23 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_mg_pre_n = sum(ifelse(considering20_11 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_sb_pre_n = sum(ifelse(considering20_4 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_mb_pre_n = sum(ifelse(considering20_1 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_wm_pre_n = sum(ifelse(considering20_16 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_mn_pre_n = sum(ifelse(considering20_97 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_js_pre_n = sum(ifelse(considering20_25 == 1, weight_predebate, 0), na.rm = TRUE),
              considering20_jb_post_n = sum(ifelse(considering20_2 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_bs_post_n = sum(ifelse(considering20_20 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_kh_post_n = sum(ifelse(considering20_12 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_bo_post_n = sum(ifelse(considering20_18 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_cb_post_n = sum(ifelse(considering20_3 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_ak_post_n = sum(ifelse(considering20_15 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_ew_post_n = sum(ifelse(considering20_22 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_jh_post_n = sum(ifelse(considering20_13 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_kg_post_n = sum(ifelse(considering20_10 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_jd_post_n = sum(ifelse(considering20_8 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_jc_post_n = sum(ifelse(considering20_6 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_bd_post_n = sum(ifelse(considering20_7 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_tg_post_n = sum(ifelse(considering20_9 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_pb_post_n = sum(ifelse(considering20_5 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_ji_post_n = sum(ifelse(considering20_14 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_tr_post_n = sum(ifelse(considering20_19 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_sm_post_n = sum(ifelse(considering20_17 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_es_post_n = sum(ifelse(considering20_21 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_ay_post_n = sum(ifelse(considering20_24 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_mw_post_n = sum(ifelse(considering20_23 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_mg_post_n = sum(ifelse(considering20_11 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_sb_post_n = sum(ifelse(considering20_4 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_mb_post_n = sum(ifelse(considering20_1 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_wm_post_n = sum(ifelse(considering20_16 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              considering20_js_post_n = sum(ifelse(considering20_25 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_jb_pre_n = sum(ifelse(demprim20_horserace == 2, weight_predebate, 0), na.rm = TRUE),
              horse_bs_pre_n = sum(ifelse(demprim20_horserace == 20, weight_predebate, 0), na.rm = TRUE),
              horse_kh_pre_n = sum(ifelse(demprim20_horserace == 12, weight_predebate, 0), na.rm = TRUE),
              horse_bo_pre_n = sum(ifelse(demprim20_horserace == 18, weight_predebate, 0), na.rm = TRUE),
              horse_cb_pre_n = sum(ifelse(demprim20_horserace == 3, weight_predebate, 0), na.rm = TRUE),
              horse_ak_pre_n = sum(ifelse(demprim20_horserace == 15, weight_predebate, 0), na.rm = TRUE),
              horse_ew_pre_n = sum(ifelse(demprim20_horserace == 22, weight_predebate, 0), na.rm = TRUE),
              horse_jh_pre_n = sum(ifelse(demprim20_horserace == 13, weight_predebate, 0), na.rm = TRUE),
              horse_kg_pre_n = sum(ifelse(demprim20_horserace == 10, weight_predebate, 0), na.rm = TRUE),
              horse_jd_pre_n = sum(ifelse(demprim20_horserace == 8, weight_predebate, 0), na.rm = TRUE),
              horse_jc_pre_n = sum(ifelse(demprim20_horserace == 6, weight_predebate, 0), na.rm = TRUE),
              horse_bd_pre_n = sum(ifelse(demprim20_horserace == 7, weight_predebate, 0), na.rm = TRUE),
              horse_tg_pre_n = sum(ifelse(demprim20_horserace == 9, weight_predebate, 0), na.rm = TRUE),
              horse_pb_pre_n = sum(ifelse(demprim20_horserace == 5, weight_predebate, 0), na.rm = TRUE),
              horse_ji_pre_n = sum(ifelse(demprim20_horserace == 14, weight_predebate, 0), na.rm = TRUE),
              horse_tr_pre_n = sum(ifelse(demprim20_horserace == 19, weight_predebate, 0), na.rm = TRUE),
              horse_sm_pre_n = sum(ifelse(demprim20_horserace == 17, weight_predebate, 0), na.rm = TRUE),
              horse_es_pre_n = sum(ifelse(demprim20_horserace == 21, weight_predebate, 0), na.rm = TRUE),
              horse_ay_pre_n = sum(ifelse(demprim20_horserace == 24, weight_predebate, 0), na.rm = TRUE),
              horse_mw_pre_n = sum(ifelse(demprim20_horserace == 23, weight_predebate, 0), na.rm = TRUE),
              horse_mg_pre_n = sum(ifelse(demprim20_horserace == 11, weight_predebate, 0), na.rm = TRUE),
              horse_sb_pre_n = sum(ifelse(demprim20_horserace == 4, weight_predebate, 0), na.rm = TRUE),
              horse_mb_pre_n = sum(ifelse(demprim20_horserace == 1, weight_predebate, 0), na.rm = TRUE),
              horse_wm_pre_n = sum(ifelse(demprim20_horserace == 16, weight_predebate, 0), na.rm = TRUE),
              horse_js_pre_n = sum(ifelse(demprim20_horserace == 25, weight_predebate, 0), na.rm = TRUE),
              horse_jb_post_n = sum(ifelse(demprim20_horserace == 2, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_bs_post_n = sum(ifelse(demprim20_horserace == 20, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_kh_post_n = sum(ifelse(demprim20_horserace == 12, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_bo_post_n = sum(ifelse(demprim20_horserace == 18, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_cb_post_n = sum(ifelse(demprim20_horserace == 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_ak_post_n = sum(ifelse(demprim20_horserace == 15, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_ew_post_n = sum(ifelse(demprim20_horserace == 22, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_jh_post_n = sum(ifelse(demprim20_horserace == 13, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_kg_post_n = sum(ifelse(demprim20_horserace == 10, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_jd_post_n = sum(ifelse(demprim20_horserace == 8, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_jc_post_n = sum(ifelse(demprim20_horserace == 6, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_bd_post_n = sum(ifelse(demprim20_horserace == 7, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_tg_post_n = sum(ifelse(demprim20_horserace == 9, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_pb_post_n = sum(ifelse(demprim20_horserace == 5, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_ji_post_n = sum(ifelse(demprim20_horserace == 14, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_tr_post_n = sum(ifelse(demprim20_horserace == 19, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_sm_post_n = sum(ifelse(demprim20_horserace == 17, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_es_post_n = sum(ifelse(demprim20_horserace == 21, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_ay_post_n = sum(ifelse(demprim20_horserace == 24, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_mw_post_n = sum(ifelse(demprim20_horserace == 23, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_mg_post_n = sum(ifelse(demprim20_horserace == 11, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_sb_post_n = sum(ifelse(demprim20_horserace == 4, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_mb_post_n = sum(ifelse(demprim20_horserace == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_wm_post_n = sum(ifelse(demprim20_horserace == 16, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              horse_js_post_n = sum(ifelse(demprim20_horserace == 25, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_jb_pre_n = sum(ifelse(pred20 == 2, weight_predebate, 0), na.rm = TRUE),
              pred_bs_pre_n = sum(ifelse(pred20 == 20, weight_predebate, 0), na.rm = TRUE),
              pred_kh_pre_n = sum(ifelse(pred20 == 12, weight_predebate, 0), na.rm = TRUE),
              pred_bo_pre_n = sum(ifelse(pred20 == 18, weight_predebate, 0), na.rm = TRUE),
              pred_cb_pre_n = sum(ifelse(pred20 == 3, weight_predebate, 0), na.rm = TRUE),
              pred_ak_pre_n = sum(ifelse(pred20 == 15, weight_predebate, 0), na.rm = TRUE),
              pred_ew_pre_n = sum(ifelse(pred20 == 22, weight_predebate, 0), na.rm = TRUE),
              pred_jh_pre_n = sum(ifelse(pred20 == 13, weight_predebate, 0), na.rm = TRUE),
              pred_kg_pre_n = sum(ifelse(pred20 == 10, weight_predebate, 0), na.rm = TRUE),
              pred_jd_pre_n = sum(ifelse(pred20 == 8, weight_predebate, 0), na.rm = TRUE),
              pred_jc_pre_n = sum(ifelse(pred20 == 6, weight_predebate, 0), na.rm = TRUE),
              pred_bd_pre_n = sum(ifelse(pred20 == 7, weight_predebate, 0), na.rm = TRUE),
              pred_tg_pre_n = sum(ifelse(pred20 == 9, weight_predebate, 0), na.rm = TRUE),
              pred_pb_pre_n = sum(ifelse(pred20 == 5, weight_predebate, 0), na.rm = TRUE),
              pred_ji_pre_n = sum(ifelse(pred20 == 14, weight_predebate, 0), na.rm = TRUE),
              pred_tr_pre_n = sum(ifelse(pred20 == 19, weight_predebate, 0), na.rm = TRUE),
              pred_sm_pre_n = sum(ifelse(pred20 == 17, weight_predebate, 0), na.rm = TRUE),
              pred_es_pre_n = sum(ifelse(pred20 == 21, weight_predebate, 0), na.rm = TRUE),
              pred_ay_pre_n = sum(ifelse(pred20 == 24, weight_predebate, 0), na.rm = TRUE),
              pred_mw_pre_n = sum(ifelse(pred20 == 23, weight_predebate, 0), na.rm = TRUE),
              pred_mg_pre_n = sum(ifelse(pred20 == 11, weight_predebate, 0), na.rm = TRUE),
              pred_sb_pre_n = sum(ifelse(pred20 == 4, weight_predebate, 0), na.rm = TRUE),
              pred_mb_pre_n = sum(ifelse(pred20 == 1, weight_predebate, 0), na.rm = TRUE),
              pred_wm_pre_n = sum(ifelse(pred20 == 16, weight_predebate, 0), na.rm = TRUE),
              pred_mn_pre_n = sum(ifelse(pred20 == 97, weight_predebate, 0), na.rm = TRUE),
              pred_js_pre_n = sum(ifelse(pred20 == 25, weight_predebate, 0), na.rm = TRUE),
              pred_jb_post_n = sum(ifelse(pred20 == 2, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_bs_post_n = sum(ifelse(pred20 == 20, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_kh_post_n = sum(ifelse(pred20 == 12, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_bo_post_n = sum(ifelse(pred20 == 18, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_cb_post_n = sum(ifelse(pred20 == 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_ak_post_n = sum(ifelse(pred20 == 15, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_ew_post_n = sum(ifelse(pred20 == 22, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_jh_post_n = sum(ifelse(pred20 == 13, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_kg_post_n = sum(ifelse(pred20 == 10, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_jd_post_n = sum(ifelse(pred20 == 8, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_jc_post_n = sum(ifelse(pred20 == 6, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_bd_post_n = sum(ifelse(pred20 == 7, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_tg_post_n = sum(ifelse(pred20 == 9, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_pb_post_n = sum(ifelse(pred20 == 5, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_ji_post_n = sum(ifelse(pred20 == 14, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_tr_post_n = sum(ifelse(pred20 == 19, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_sm_post_n = sum(ifelse(pred20 == 17, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_es_post_n = sum(ifelse(pred20 == 21, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_ay_post_n = sum(ifelse(pred20 == 24, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_mw_post_n = sum(ifelse(pred20 == 23, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_mg_post_n = sum(ifelse(pred20 == 11, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_sb_post_n = sum(ifelse(pred20 == 4, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_mb_post_n = sum(ifelse(pred20 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_wm_post_n = sum(ifelse(pred20 == 16, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_mn_post_n = sum(ifelse(pred20 == 97, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              pred_js_post_n = sum(ifelse(pred20 == 25, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_jb_pre_n = sum(ifelse(magicwand20 == 2, weight_predebate, 0), na.rm = TRUE),
              magicwand_bs_pre_n = sum(ifelse(magicwand20 == 20, weight_predebate, 0), na.rm = TRUE),
              magicwand_kh_pre_n = sum(ifelse(magicwand20 == 12, weight_predebate, 0), na.rm = TRUE),
              magicwand_bo_pre_n = sum(ifelse(magicwand20 == 18, weight_predebate, 0), na.rm = TRUE),
              magicwand_cb_pre_n = sum(ifelse(magicwand20 == 3, weight_predebate, 0), na.rm = TRUE),
              magicwand_ak_pre_n = sum(ifelse(magicwand20 == 15, weight_predebate, 0), na.rm = TRUE),
              magicwand_ew_pre_n = sum(ifelse(magicwand20 == 22, weight_predebate, 0), na.rm = TRUE),
              magicwand_jh_pre_n = sum(ifelse(magicwand20 == 13, weight_predebate, 0), na.rm = TRUE),
              magicwand_kg_pre_n = sum(ifelse(magicwand20 == 10, weight_predebate, 0), na.rm = TRUE),
              magicwand_jd_pre_n = sum(ifelse(magicwand20 == 8, weight_predebate, 0), na.rm = TRUE),
              magicwand_jc_pre_n = sum(ifelse(magicwand20 == 6, weight_predebate, 0), na.rm = TRUE),
              magicwand_bd_pre_n = sum(ifelse(magicwand20 == 7, weight_predebate, 0), na.rm = TRUE),
              magicwand_tg_pre_n = sum(ifelse(magicwand20 == 9, weight_predebate, 0), na.rm = TRUE),
              magicwand_pb_pre_n = sum(ifelse(magicwand20 == 5, weight_predebate, 0), na.rm = TRUE),
              magicwand_ji_pre_n = sum(ifelse(magicwand20 == 14, weight_predebate, 0), na.rm = TRUE),
              magicwand_tr_pre_n = sum(ifelse(magicwand20 == 19, weight_predebate, 0), na.rm = TRUE),
              magicwand_sm_pre_n = sum(ifelse(magicwand20 == 17, weight_predebate, 0), na.rm = TRUE),
              magicwand_es_pre_n = sum(ifelse(magicwand20 == 21, weight_predebate, 0), na.rm = TRUE),
              magicwand_ay_pre_n = sum(ifelse(magicwand20 == 24, weight_predebate, 0), na.rm = TRUE),
              magicwand_mw_pre_n = sum(ifelse(magicwand20 == 23, weight_predebate, 0), na.rm = TRUE),
              magicwand_mg_pre_n = sum(ifelse(magicwand20 == 11, weight_predebate, 0), na.rm = TRUE),
              magicwand_sb_pre_n = sum(ifelse(magicwand20 == 4, weight_predebate, 0), na.rm = TRUE),
              magicwand_mb_pre_n = sum(ifelse(magicwand20 == 1, weight_predebate, 0), na.rm = TRUE),
              magicwand_wm_pre_n = sum(ifelse(magicwand20 == 16, weight_predebate, 0), na.rm = TRUE),
              magicwand_mn_pre_n = sum(ifelse(magicwand20 == 97, weight_predebate, 0), na.rm = TRUE),
              magicwand_js_pre_n = sum(ifelse(magicwand20 == 25, weight_predebate, 0), na.rm = TRUE),
              magicwand_jb_post_n = sum(ifelse(magicwand20 == 2, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_bs_post_n = sum(ifelse(magicwand20 == 20, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_kh_post_n = sum(ifelse(magicwand20 == 12, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_bo_post_n = sum(ifelse(magicwand20 == 18, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_cb_post_n = sum(ifelse(magicwand20 == 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_ak_post_n = sum(ifelse(magicwand20 == 15, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_ew_post_n = sum(ifelse(magicwand20 == 22, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_jh_post_n = sum(ifelse(magicwand20 == 13, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_kg_post_n = sum(ifelse(magicwand20 == 10, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_jd_post_n = sum(ifelse(magicwand20 == 8, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_jc_post_n = sum(ifelse(magicwand20 == 6, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_bd_post_n = sum(ifelse(magicwand20 == 7, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_tg_post_n = sum(ifelse(magicwand20 == 9, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_pb_post_n = sum(ifelse(magicwand20 == 5, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_ji_post_n = sum(ifelse(magicwand20 == 14, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_tr_post_n = sum(ifelse(magicwand20 == 19, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_sm_post_n = sum(ifelse(magicwand20 == 17, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_es_post_n = sum(ifelse(magicwand20 == 21, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_ay_post_n = sum(ifelse(magicwand20 == 24, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_mw_post_n = sum(ifelse(magicwand20 == 23, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_mg_post_n = sum(ifelse(magicwand20 == 11, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_sb_post_n = sum(ifelse(magicwand20 == 4, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_mb_post_n = sum(ifelse(magicwand20 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_wm_post_n = sum(ifelse(magicwand20 == 16, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_mn_post_n = sum(ifelse(magicwand20 == 97, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              magicwand_js_post_n = sum(ifelse(magicwand20 == 25, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_jb_pre_n = sum(ifelse(absnot20 == 2, weight_predebate, 0), na.rm = TRUE),
              absnot_bs_pre_n = sum(ifelse(absnot20 == 20, weight_predebate, 0), na.rm = TRUE),
              absnot_kh_pre_n = sum(ifelse(absnot20 == 12, weight_predebate, 0), na.rm = TRUE),
              absnot_bo_pre_n = sum(ifelse(absnot20 == 18, weight_predebate, 0), na.rm = TRUE),
              absnot_cb_pre_n = sum(ifelse(absnot20 == 3, weight_predebate, 0), na.rm = TRUE),
              absnot_ak_pre_n = sum(ifelse(absnot20 == 15, weight_predebate, 0), na.rm = TRUE),
              absnot_ew_pre_n = sum(ifelse(absnot20 == 22, weight_predebate, 0), na.rm = TRUE),
              absnot_jh_pre_n = sum(ifelse(absnot20 == 13, weight_predebate, 0), na.rm = TRUE),
              absnot_kg_pre_n = sum(ifelse(absnot20 == 10, weight_predebate, 0), na.rm = TRUE),
              absnot_jd_pre_n = sum(ifelse(absnot20 == 8, weight_predebate, 0), na.rm = TRUE),
              absnot_jc_pre_n = sum(ifelse(absnot20 == 6, weight_predebate, 0), na.rm = TRUE),
              absnot_bd_pre_n = sum(ifelse(absnot20 == 7, weight_predebate, 0), na.rm = TRUE),
              absnot_tg_pre_n = sum(ifelse(absnot20 == 9, weight_predebate, 0), na.rm = TRUE),
              absnot_pb_pre_n = sum(ifelse(absnot20 == 5, weight_predebate, 0), na.rm = TRUE),
              absnot_ji_pre_n = sum(ifelse(absnot20 == 14, weight_predebate, 0), na.rm = TRUE),
              absnot_tr_pre_n = sum(ifelse(absnot20 == 19, weight_predebate, 0), na.rm = TRUE),
              absnot_sm_pre_n = sum(ifelse(absnot20 == 17, weight_predebate, 0), na.rm = TRUE),
              absnot_es_pre_n = sum(ifelse(absnot20 == 21, weight_predebate, 0), na.rm = TRUE),
              absnot_ay_pre_n = sum(ifelse(absnot20 == 24, weight_predebate, 0), na.rm = TRUE),
              absnot_mw_pre_n = sum(ifelse(absnot20 == 23, weight_predebate, 0), na.rm = TRUE),
              absnot_mg_pre_n = sum(ifelse(absnot20 == 11, weight_predebate, 0), na.rm = TRUE),
              absnot_sb_pre_n = sum(ifelse(absnot20 == 4, weight_predebate, 0), na.rm = TRUE),
              absnot_mb_pre_n = sum(ifelse(absnot20 == 1, weight_predebate, 0), na.rm = TRUE),
              absnot_wm_pre_n = sum(ifelse(absnot20 == 16, weight_predebate, 0), na.rm = TRUE),
              absnot_mn_pre_n = sum(ifelse(absnot20 == 97, weight_predebate, 0), na.rm = TRUE),
              absnot_js_pre_n = sum(ifelse(absnot20 == 25, weight_predebate, 0), na.rm = TRUE),
              absnot_jb_post_n = sum(ifelse(absnot20 == 2, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_bs_post_n = sum(ifelse(absnot20 == 20, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_kh_post_n = sum(ifelse(absnot20 == 12, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_bo_post_n = sum(ifelse(absnot20 == 18, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_cb_post_n = sum(ifelse(absnot20 == 3, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_ak_post_n = sum(ifelse(absnot20 == 15, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_ew_post_n = sum(ifelse(absnot20 == 22, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_jh_post_n = sum(ifelse(absnot20 == 13, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_kg_post_n = sum(ifelse(absnot20 == 10, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_jd_post_n = sum(ifelse(absnot20 == 8, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_jc_post_n = sum(ifelse(absnot20 == 6, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_bd_post_n = sum(ifelse(absnot20 == 7, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_tg_post_n = sum(ifelse(absnot20 == 9, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_pb_post_n = sum(ifelse(absnot20 == 5, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_ji_post_n = sum(ifelse(absnot20 == 14, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_tr_post_n = sum(ifelse(absnot20 == 19, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_sm_post_n = sum(ifelse(absnot20 == 17, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_es_post_n = sum(ifelse(absnot20 == 21, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_ay_post_n = sum(ifelse(absnot20 == 24, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_mw_post_n = sum(ifelse(absnot20 == 23, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_mg_post_n = sum(ifelse(absnot20 == 11, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_sb_post_n = sum(ifelse(absnot20 == 4, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_mb_post_n = sum(ifelse(absnot20 == 1, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_wm_post_n = sum(ifelse(absnot20 == 16, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_mn_post_n = sum(ifelse(absnot20 == 97, as.numeric(weight_postdebate), 0), na.rm = TRUE),
              absnot_js_post_n = sum(ifelse(absnot20 == 25, as.numeric(weight_postdebate), 0), na.rm = TRUE))
  
  
  dfp_n %>%
    mutate_at(.vars = colnames(dfp_n)[grepl(pattern = '_n',x = colnames(dfp_n))], .funs = list(pct = calculate_pcts))%>%
    mutate(xtab_order = xtab_order, var_group = row_var)%>%
    select(xtab_order, var_group, grouper, contains('n'))%>%
    inner_join(dfp_n%>%select(grouper, avg_sexism, avg_racism))
}
```

This code recodes some of the variables for ease of presentation
```{r}
dfp_xtabs <- dfp%>%
  mutate(region = case_when(region == 1 ~ 'Northeast',
                            region == 2 ~ 'Midwest',
                            region == 3 ~ 'South',
                            region == 4 ~ 'West'),
         sexharass_x_gender = case_when(sexharass == 1 & gender == 1 ~ 'Male - Sexually Assualted',
                                        sexharass == 1 & gender == 2 ~ 'Female - Sexually Assualted',
                                        sexharass == 2 & gender == 1 ~ 'Male - Not Assualted',
                                        sexharass == 2 & gender == 2 ~ 'Female - Not Assualted'),
         sexharass_x_race2 = case_when(sexharass == 1 & race2 == 1 ~ 'White - Sexually Assualted',
                                       sexharass == 1 & race2 == 2 ~ 'Non-White - Sexually Assualted',
                                       sexharass == 2 & race2 == 1 ~ 'White - Not Assualted',
                                       sexharass == 2 & race2 == 2 ~ 'Non-White - Not Assualted'),
         race2_x_educ2 = case_when(race2 == 1 & educ2 == 1 ~ 'White - Non-College',
                                   race2 == 1 & educ2 == 2 ~ 'White - College',
                                   race2 == 2 & educ2 == 1 ~ 'Non-White - Non-College',
                                   race2 == 2 & educ2 == 2 ~ 'Non-White - College'),
         race_x_urbanity = case_when(race2 == 1 & urbancity == 1 ~ 'White - Urban-College',
                                     race2 == 1 & urbancity == 2 ~ 'White - Suburban',
                                     race2 == 1 & urbancity %in% c(3,4) ~ 'White - Small Town/Rural',
                                     race2 == 2 & urbancity == 1 ~ 'Non-White - Urban',
                                     race2 == 2 & urbancity == 2 ~ 'Non-White - Suburban',
                                     race2 == 2 & urbancity %in% c(3,4) ~ 'Non-White - Small Town/Rural'),
         gender = case_when(gender == 1 ~ 'Male',
                            gender == 2 ~ 'Female'),
         age5 = case_when(age5 == 1 ~ '18 to 29',
                          age5 == 2 ~ '30 to 44',
                          age5 == 3 ~ '45 to 54',
                          age5 == 4 ~ '55 to 64',
                          age5 == 5 ~ '65 plus'),
         race4 = case_when(race4 == 1 ~ 'White',
                           race4 == 2 ~ 'Black',
                           race4 == 3 ~ 'Hispanic',
                           race4 == 4 ~ 'Other'),
         educ2 = case_when(educ2 == 1 ~ 'Less than College',
                           educ2 == 2 ~ 'College'),
         pid3_condensed = case_when(pid3_condensed == 1 ~ 'Democrat',
                                    pid3_condensed == 2 ~ 'Republican',
                                    pid3_condensed == 3 ~ 'Independent'),
         ideo5 = case_when(ideo5 == 1 ~ 'Very liberal',
                           ideo5 == 2 ~ 'Liberal',
                           ideo5 == 3 ~ 'Moderate',
                           ideo5 == 4 ~ 'Conservative',
                           ideo5 == 5 ~ 'Very conservative',
                           ideo5 == 6 ~ 'Not Sure'),
         state_election_type = case_when(state_election_type == 1 ~ 'Caucus',
                                         state_election_type == 2 ~ 'Primary'),
         electa_which = case_when(electa_which == 1 ~ 'Persuade',
                                  electa_which == 2 ~ 'Mobilize',
                                  electa_which == 3 ~ 'Don\'t Know'),
         greenjob = case_when(greenjob == 1 ~ 'Strongly support',
                              greenjob == 2 ~ 'Somewhat support',
                              greenjob == 3 ~ 'Neither support nor oppose',
                              greenjob == 4 ~ 'Somewhat oppose',
                              greenjob == 5 ~ 'Strongly oppose',
                              greenjob == 6 ~ 'Not sure'),
         clean = case_when(clean == 1 ~ 'Strongly support',
                           clean == 2 ~ 'Somewhat support',
                           clean == 3 ~ 'Neither support nor oppose',
                           clean == 4 ~ 'Somewhat oppose',
                           clean == 5 ~ 'Strongly oppose',
                           clean == 6 ~ 'Not sure'),
         process = case_when(process == 1 ~ 'Strongly support',
                             process == 2 ~ 'Somewhat support',
                             process == 3 ~ 'Neither support nor oppose',
                             process == 4 ~ 'Somewhat oppose',
                             process == 5 ~ 'Strongly oppose',
                             process == 6 ~ 'Not sure'),
         inequality = case_when(inequality == 1 ~ 'Strongly support',
                                inequality == 2 ~ 'Somewhat support',
                                inequality == 3 ~ 'Neither support nor oppose',
                                inequality == 4 ~ 'Somewhat oppose',
                                inequality == 5 ~ 'Strongly oppose',
                                inequality == 6 ~ 'Not sure'),
         details = case_when(details == 1 ~ 'Strongly support',
                             details == 2 ~ 'Somewhat support',
                             details == 3 ~ 'Neither support nor oppose',
                             details == 4 ~ 'Somewhat oppose',
                             details == 5 ~ 'Strongly oppose',
                             details == 6 ~ 'Not sure'),
         society = case_when(society == 1 ~ 'Strongly support',
                             society == 2 ~ 'Somewhat support',
                             society == 3 ~ 'Neither support nor oppose',
                             society == 4 ~ 'Somewhat oppose',
                             society == 5 ~ 'Strongly oppose',
                             society == 6 ~ 'Not sure'),
         allegiance = case_when(allegiance == 1 ~ 'Strongly support',
                                allegiance == 2 ~ 'Somewhat support',
                                allegiance == 3 ~ 'Neither support nor oppose',
                                allegiance == 4 ~ 'Somewhat oppose',
                                allegiance == 5 ~ 'Strongly oppose',
                                allegiance == 6 ~ 'Not sure'),
         class = case_when(class == 1 ~ 'Strongly support',
                           class == 2 ~ 'Somewhat support',
                           class == 3 ~ 'Neither support nor oppose',
                           class == 4 ~ 'Somewhat oppose',
                           class == 5 ~ 'Strongly oppose',
                           class == 6 ~ 'Not sure'),
         correctness = case_when(correctness == 1 ~ 'The way people talk needs to change a lot',
                                 correctness == 2 ~ 'The way people talk needs to change a little',
                                 correctness == 3 ~ 'People are a little too easily offended',
                                 correctness == 4 ~ 'People are much too easily offended',
                                 correctness == 5 ~ 'Not sure'),
         deserve_poor = case_when(deserve_poor == 1 ~ 'A lot more money than they deserve',
                                  deserve_poor == 2 ~ 'Somewhat more money than they deserve',
                                  deserve_poor == 3 ~ 'Slightly more money than they deserve',
                                  deserve_poor == 4 ~ 'About the right amount of money',
                                  deserve_poor == 5 ~ 'Slightly less money than they deserve',
                                  deserve_poor == 6 ~ 'Somewhat less money than they deserve ',
                                  deserve_poor == 7 ~ 'A lot less money than they deserve'),
         deserve_rich = case_when(deserve_rich == 1 ~ 'A lot more money than they deserve',
                                  deserve_rich == 2 ~ 'Somewhat more money than they deserve',
                                  deserve_rich == 3 ~ 'Slightly more money than they deserve',
                                  deserve_rich == 4 ~ 'About the right amount of money',
                                  deserve_rich == 5 ~ 'Slightly less money than they deserve',
                                  deserve_rich == 6 ~ 'Somewhat less money than they deserve ',
                                  deserve_rich == 7 ~ 'A lot less money than they deserve'),
         genident = case_when(genident == 1 ~ 'Very important',
                              genident == 2 ~ 'Somewhat important',
                              genident == 3 ~ 'Not very important',
                              genident == 4 ~ 'Not at all important'),
         raceident = case_when(raceident == 1 ~ 'Very important',
                               raceident == 2 ~ 'Somewhat important',
                               raceident == 3 ~ 'Not very important',
                               raceident == 4 ~ 'Not at all important'),
         linkfate = case_when(linkfate == 1 ~ 'A major impact',
                              linkfate == 2 ~ 'Somewhat of an impact',
                              linkfate == 3 ~ 'Not much of an impact',
                              linkfate == 4 ~ 'No impact'),
         amnesty = case_when(amnesty == 1 ~ 'Strongly support',
                             amnesty == 2 ~ 'Somewhat support',
                             amnesty == 3 ~ 'Neither support nor oppose',
                             amnesty == 4 ~ 'Somewhat oppose',
                             amnesty == 5 ~ 'Strongly oppose',
                             amnesty == 6 ~ 'Not sure'),
         border = case_when(border == 1 ~ 'Strongly support',
                            border == 2 ~ 'Somewhat support',
                            border == 3 ~ 'Neither support nor oppose',
                            border == 4 ~ 'Somewhat oppose',
                            border == 5 ~ 'Strongly oppose',
                            border == 6 ~ 'Not sure'),
         deport = case_when(deport == 1 ~ 'Strongly support',
                            deport == 2 ~ 'Somewhat support',
                            deport == 3 ~ 'Neither support nor oppose',
                            deport == 4 ~ 'Somewhat oppose',
                            deport == 5 ~ 'Strongly oppose',
                            deport == 6 ~ 'Not sure'),
         remarks = case_when(remarks == 1 ~ 'Strongly agree',
                             remarks == 2 ~ 'Somewhat agree',
                             remarks == 3 ~ 'Neither agree nor disagree ',
                             remarks == 4 ~ 'Somewhat disagree',
                             remarks == 5 ~ 'Strongly disagree',
                             remarks == 6 ~ 'No opinion'),
         offend = case_when(offend == 1 ~ 'Strongly agree',
                            offend == 2 ~ 'Somewhat agree',
                            offend == 3 ~ 'Neither agree nor disagree ',
                            offend == 4 ~ 'Somewhat disagree',
                            offend == 5 ~ 'Strongly disagree',
                            offend == 6 ~ 'No opinion'),
         appreciate = case_when(appreciate == 1 ~ 'Strongly agree',
                                appreciate == 2 ~ 'Somewhat agree',
                                appreciate == 3 ~ 'Neither agree nor disagree ',
                                appreciate == 4 ~ 'Somewhat disagree',
                                appreciate == 5 ~ 'Strongly disagree',
                                appreciate == 6 ~ 'No opinion'),
         control = case_when(control == 1 ~ 'Strongly agree',
                             control == 2 ~ 'Somewhat agree',
                             control == 3 ~ 'Neither agree nor disagree ',
                             control == 4 ~ 'Somewhat disagree',
                             control == 5 ~ 'Strongly disagree',
                             control == 6 ~ 'No opinion'),
         misconduct = case_when(misconduct == 1 ~ 'Strongly agree',
                                misconduct == 2 ~ 'Somewhat agree',
                                misconduct == 3 ~ 'Neither agree nor disagree ',
                                misconduct == 4 ~ 'Somewhat disagree',
                                misconduct == 5 ~ 'Strongly disagree',
                                misconduct == 6 ~ 'No opinion'),
         institution = case_when(institution == 1 ~ 'Strongly agree',
                                 institution == 2 ~ 'Somewhat agree',
                                 institution == 3 ~ 'Neither agree nor disagree ',
                                 institution == 4 ~ 'Somewhat disagree',
                                 institution == 5 ~ 'Strongly disagree',
                                 institution == 6 ~ 'No opinion'),
         system = case_when(system == 1 ~ 'Strongly agree',
                            system == 2 ~ 'Somewhat agree',
                            system == 3 ~ 'Neither agree nor disagree ',
                            system == 4 ~ 'Somewhat disagree',
                            system == 5 ~ 'Strongly disagree',
                            system == 6 ~ 'No opinion'),
         empathy = case_when(empathy == 1 ~ 'Strongly agree',
                             empathy == 2 ~ 'Somewhat agree',
                             empathy == 3 ~ 'Neither agree nor disagree ',
                             empathy == 4 ~ 'Somewhat disagree',
                             empathy == 5 ~ 'Strongly disagree',
                             empathy == 6 ~ 'No opinion'),
         fear = case_when(fear == 1 ~ 'Strongly agree',
                          fear == 2 ~ 'Somewhat agree',
                          fear == 3 ~ 'Neither agree nor disagree ',
                          fear == 4 ~ 'Somewhat disagree',
                          fear == 5 ~ 'Strongly disagree',
                          fear == 6 ~ 'No opinion'),
         generations = case_when(generations == 1 ~ 'Strongly agree',
                                 generations == 2 ~ 'Somewhat agree',
                                 generations == 3 ~ 'Neither agree nor disagree ',
                                 generations == 4 ~ 'Somewhat disagree',
                                 generations == 5 ~ 'Strongly disagree',
                                 generations == 6 ~ 'No opinion'),
         favors = case_when(favors == 1 ~ 'Strongly agree',
                            favors == 2 ~ 'Somewhat agree',
                            favors == 3 ~ 'Neither agree nor disagree ',
                            favors == 4 ~ 'Somewhat disagree',
                            favors == 5 ~ 'Strongly disagree',
                            favors == 6 ~ 'No opinion'),
         sexadvance = case_when(sexadvance == 1 ~ 'Never',
                                sexadvance == 2 ~ 'Rarely',
                                sexadvance == 3 ~ 'Occasionally',
                                sexadvance == 4 ~ 'Fairly often',
                                sexadvance == 5 ~ 'Very often',
                                sexadvance == 6 ~ 'Prefer not to answer'),
         sexharass = case_when(sexharass == 1 ~ 'Yes',
                               sexharass == 2 ~ 'No',
                               sexharass == 3 ~ 'Prefer not to answer'),
         turnout16 = case_when(turnout16 == 1 ~ 'Yes',
                               turnout16 == 2 ~ 'No'),
         presvote16post = case_when(presvote16post == 1 ~ 'Hillary Clinton',
                                    presvote16post == 2 ~ 'Donald Trump',
                                    presvote16post == 3 ~ 'Gary Johnson',
                                    presvote16post == 4 ~ 'Jill Stein',
                                    presvote16post == 5 ~ 'Evan McMullin',
                                    presvote16post == 6 ~ 'Other',
                                    presvote16post == 7 ~ 'Did not vote for President'),
         turnout18post = case_when(turnout18post == 1 ~ 'Yes',
                                   turnout18post == 2 ~ 'No'),
         housevote18post = case_when(housevote18post == 1 ~ 'Democratic candidate',
                                     housevote18post == 2 ~ 'Republican candidate',
                                     housevote18post == 3 ~ 'Independent candidate',
                                     housevote18post == 5 ~ 'Other candidate',
                                     housevote18post == 6 ~ 'Did not vote for U.S. House'),
         newsint = case_when(newsint == 1 ~ 'Most of the time',
                             newsint == 2 ~ 'Some of the time',
                             newsint == 3 ~ 'Only now and then',
                             newsint == 4 ~ 'Hardly at all',
                             newsint == 7 ~ 'Not Sure'),
         union_combined = case_when(union_combined_1 == 1 ~ 'Yes, current member',
                                    union_combined_5 == 1 ~ 'Yes, retired member',
                                    union_combined_2 == 1 ~ 'Yes, someone in household is a current member',
                                    union_combined_6 == 1 ~ 'Yes, someone in household is a retired member',
                                    union_combined_3 == 1 ~ 'No one in household is a member',
                                    union_combined_4 == 1 ~ 'Not sure'),
         urbancity = case_when(urbancity == 1 ~ 'City',
                               urbancity == 2 ~ 'Suburb',
                               urbancity == 3 ~ 'Town',
                               urbancity == 4 ~ 'Rural Area',
                               urbancity == 5 ~ 'Other'),
         faminc_new = case_when(faminc_new %in% c(1,2,3,4,5) ~ 'Less than $50,000',
                                faminc_new %in% c(6,7,8,9) ~ '$50,000 to $100,000',
                                faminc_new %in% c(10,11,12,13,14,15,16) ~ 'More than $100,000',
                                faminc_new == 97 ~ 'Refused'),
         sexism_quintile = as.character(sexism_quintile),
         racism_quintile = as.character(racism_quintile),
         topline = 'All Voters'
  )

```

Run both xtabber functions and export output to csv
```{r}
xtab_vars <- c('topline', 'region', 'gender', 'age5', 'race4', 'educ2', 'pid3_condensed', 'ideo5', 'state_election_type', 'electa_which', 'greenjob', 'clean', 'process', 'inequality', 'details', 'society', 'allegiance', 'class', 'correctness', 'deserve_poor', 'deserve_rich', 'genident', 'raceident', 'linkfate', 'amnesty', 'border', 'deport', 'remarks', 'offend', 'appreciate', 'control', 'misconduct', 'institution', 'system', 'empathy', 'fear', 'generations', 'favors', 'sexadvance', 'sexharass', 'turnout16', 'presvote16post', 'turnout18post', 'housevote18post', 'newsint', 'union_combined', 'urbancity', 'faminc_new', 'sexharass_x_gender', 'sexharass_x_race2', 'race2_x_educ2', 'race_x_urbanity', 'sexism_quintile', 'racism_quintile')

xtab_tables <- list()
for(i in seq(1,length(xtab_vars))){
  xtab_tables[[i]] <- xtabber(tbl = dfp_xtabs, xtab_order = i, row_var = xtab_vars[i])  
}

bind_rows(xtab_tables)%>%write_csv('xtabs_calculated.csv')
```

